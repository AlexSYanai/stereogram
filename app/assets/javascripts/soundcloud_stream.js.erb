$(document).ready(function(){
  SC.initialize({
    client_id: "<%= ENV['SOUNDCLOUD_APP_ID'] %>",
    // Recommend setting this in an initializer or something so that you can do
    // <%= Rails.config.heroku_callback -%> or some such
    redirect_uri: 'http://cryptic-dusk-7305.herokuapp.com/callback'
  });

  $('#connect').click(function(){
    new SoundcloudUser.searchSongs(function(response) {
      $('body').append(response)
    });
  })

  $('.track').on('click', function(event){
    track = new Track({
      id: event.currentTarget.dataset.trackId,
      source_id: event.currentTarget.dataset.sourceId
    });
    track.audio.play()
  })

  $('.snippet').on('click', function(event){
    var snipData = event.currentTarget.dataset;
    var snippetTrack = new Track({source_id: snipData.sourceId});
    snippet = new Snippet({track: snippetTrack, startTime: snipData.startTime, endTime: snipData.endTime
    });
    snippet.playSnip();
  })

  $('body').on('click', '#pause', function(event){
    track.audio.pause()
    $(this).replaceWith("<div id='play'>PLAY~</div>")
  })

  $('body').on('click', '#play', function(event){
    track.audio.play()
    $(this).replaceWith("<div id='pause'>PAUSE~</div>")
  })

  // Also, there's a good chance this may cause your double play issue...
  $('body').on('click', '#snip', function(event){
    var endTime = track.audio.currentTime;
    var startTime = track.audio.currentTime - 15;
    var newSnippet = new Snippet(
      {track: track,
      startTime: startTime,
      endTime: endTime});
    $.ajax({
      url: '/snippets',
      method: 'POST',
      data: {snippet: newSnippet.asHtmlFriendlyParams() },
    }).done(function(response){
      $('.user-snippets').append(response);
    })
  })
});
