$(document).ready(function(){
  SC.initialize({
    client_id: "<%= ENV['SOUNDCLOUD_APP_ID'] %>",
    redirect_uri: 'http://localhost:3000/callback'
  });

  $('#connect').click(function(){
    var currentUser = new SoundcloudUser
    currentUser.searchSongs();
  })

  $('.track').on('click', function(event){
    track = new Track({id: event.currentTarget.dataset.trackId, source_id: event.currentTarget.dataset.sourceId})
    track.audio.play()
  })

  $('.snippet').on('click', function(event){
    snippet = new Snippet()
  })

  $('body').on('click', '#pause', function(event){
    track.audio.pause()
    $(this).replaceWith("<div id='play'>PLAY~</div>")
  })

  $('body').on('click', '#play', function(event){
    track.audio.play()
    $(this).replaceWith("<div id='pause'>PAUSE~</div>")
  })



  $('body').on('click', '#snip', function(event){
    var endTime = track.audio.currentTime
    var startTime = track.audio.currentTime - 15
    var newSnippet = new Snippet(track, startTime, endTime)
    $.ajax({
      url: '/snippets',
      method: 'POST',
      data: {snippet: newSnippet},
      dataType: 'JSON'
    })
  })

  var getBackend = function(){
    $.getJSON( window.location.pathname + "/userTracks" ,function( data ) {
      var tracks = data.tracks
      var snippets = data.snippets
      $.each( snippets , function( key, val ) {
        snippet = new Snippet()
      });
    })
  }

  getBackend();


});