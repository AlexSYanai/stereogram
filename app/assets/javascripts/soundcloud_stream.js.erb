snippetLength = function(constant){
  SNIPPET_LENGTH_CONSTANT = constant || 15;
}
snippetLength();

$('#connect').click(function(){
  new SoundcloudUser
})

$('.user-tracks').on('click', '.track', function(event){
  if(window.currentAudio){
    currentAudio.pause();
    clearInterval(rotInt);
  }
  rotate = 0;
  clickedTrack = event.currentTarget
  var track = new Track({id: clickedTrack.dataset.trackId, source_id: clickedTrack.dataset.sourceId})
  $('#soundplayer-widget-picture').attr('src',clickedTrack.dataset.artworkUrl);
  currentAudio = track.audio
  currentAudio.play()
  rotInt = setInterval(function(){
    document.getElementById('soundplayer-widget-picture').style.transform = "rotate("+rotate+"deg)"
    rotate = rotate + 0.025},1)
})

$('.user-snippets').on('click', '.snippet', function(event){
  if(window.currentAudio){
    currentAudio.pause();
  }
  clickedTrack = event.currentTarget;
  var snipData = clickedTrack.dataset;
  var snippetTrack = new Track({source_id: snipData.sourceId});
  var snippet = new Snippet({track: snippetTrack, startTime: snipData.startTime, endTime: snipData.endTime
  });
  snippet.playSnip();
})

$('.widget').on('click', '.icon.stop', function(event){
  track.audio.pause();
  clearInterval(rotInt);
})

$('.widget').on('click', '.icon.play', function(event){
  rotInt = setInterval(function(){
    document.getElementById('soundplayer-widget-picture').style.transform = "rotate("+rotate+"deg)"
    rotate = rotate + 0.025},1)
  track.audio.play();
})

$('.widget').on('click', '.icon.next', function(event){
  if (window.clickedTrack){
    clickedTrack.nextElementSibling.click()
  }
})

$('.widget').on('click', '.icon.previous', function(event){
  if (window.clickedTrack){
    clickedTrack.previousElementSibling.click();
  }
})

$('.widget').on('click', '.icon.snip', function(event){
  var endTime = track.audio.currentTime;
  var startTime = track.audio.currentTime - SNIPPET_LENGTH_CONSTANT;
  var newSnippet = new Snippet(
    {track: track,
    startTime: startTime,
    endTime: endTime});
  $.ajax({
    url: '/snippets',
    method: 'POST',
    data: {snippet: {track_id: newSnippet.track_id, start_time: newSnippet.start_time, end_time: newSnippet.end_time}},
  }).done(function(response){
    $('.user-snippets').append(response);
  })
});
