SNIPPET_LENGTH_CONSTANT = 15;

$('#connect').click(function(){
  new SoundcloudUser
})

$('.user-tracks').on('click', '.track', function(event){
  if(window.track){
    track.audio.pause()
  }
  clickedTrack = event.currentTarget
  track = new Track({id: event.currentTarget.dataset.trackId, source_id: event.currentTarget.dataset.sourceId})
  track.audio.play()
})

$('.user-snippets').on('click', '.snippet', function(event){
  var snipData = event.currentTarget.dataset;
  var snippetTrack = new Track({source_id: snipData.sourceId});
  snippet = new Snippet({track: snippetTrack, startTime: snipData.startTime, endTime: snipData.endTime
  });
  snippet.playSnip();
})

$('.widget').on('click', '.icon.stop', function(event){
  track.audio.pause();
})

$('.widget').on('click', '.icon.play', function(event){
  track.audio.play();
})

$('.widget').on('click', '.icon.next', function(event){
  if (window.clickedTrack){
    clickedTrack.nextElementSibling.click()
  }
})

$('.widget').on('click', '.icon.previous', function(event){
  if (window.clickedTrack){
    clickedTrack.previousElementSibling.click();
  }
})

$('.widget').on('click', '.icon.snip', function(event){
  var endTime = track.audio.currentTime;
  var startTime = track.audio.currentTime - SNIPPET_LENGTH_CONSTANT;
  var newSnippet = new Snippet(
    {track: track,
    startTime: startTime,
    endTime: endTime});
  $.ajax({
    url: '/snippets',
    method: 'POST',
    data: {snippet: {track_id: newSnippet.track_id, start_time: newSnippet.start_time, end_time: newSnippet.end_time}},
  }).done(function(response){
    $('.user-snippets').append(response);
  })
});
